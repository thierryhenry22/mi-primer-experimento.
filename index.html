<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Minecraft 3D Open World</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #87CEEB; font-family: sans-serif; }
        #crosshair {
            position: absolute; top: 50%; left: 50%;
            width: 20px; height: 20px;
            border: 2px solid white; border-radius: 50%;
            transform: translate(-50%, -50%); pointer-events: none;
        }
        #instructions {
            position: absolute; bottom: 20px; left: 20px;
            color: white; background: rgba(0,0,0,0.5); padding: 10px;
        }
    </style>
</head>
<body>
    <div id="crosshair"></div>
    <div id="instructions">CLIC PARA JUGAR | W,A,S,D: Mover | ESPACIO: Saltar</div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

        // --- CONFIGURACIÓN ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB); // Cielo
        scene.fog = new THREE.FogExp2(0x87CEEB, 0.01);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: false }); // Antialias off para look pixel
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // --- CONTROLES ---
        const controls = new PointerLockControls(camera, document.body);
        document.body.addEventListener('click', () => controls.lock());

        // --- GENERACIÓN DE TERRENO (SIMPLIFICADA) ---
        const worldSize = 40; // Tamaño del chunk inicial
        const blockSize = 1;
        const geometry = new THREE.BoxGeometry(blockSize, blockSize, blockSize);
        
        // Colores de materiales
        const materialGrass = new THREE.MeshLambertMaterial({ color: 0x559944 });
        const materialDirt = new THREE.MeshLambertMaterial({ color: 0x8B4513 });

        const instancedBlocks = new THREE.InstancedMesh(geometry, materialGrass, Math.pow(worldSize, 2) * 5);
        scene.add(instancedBlocks);

        const dummy = new THREE.Object3D();
        let count = 0;

        // Función de ruido simple para colinas
        const generateHeight = (x, z) => {
            return Math.floor(Math.sin(x * 0.1) * Math.cos(z * 0.1) * 4) + 5;
        };

        for (let x = -worldSize; x < worldSize; x++) {
            for (let z = -worldSize; z < worldSize; z++) {
                const h = generateHeight(x, z);
                for (let y = 0; y < h; y++) {
                    dummy.position.set(x, y, z);
                    dummy.updateMatrix();
                    instancedBlocks.setMatrixAt(count++, dummy.matrix);
                }
            }
        }

        // --- ILUMINACIÓN ---
        const sun = new THREE.DirectionalLight(0xffffff, 1.2);
        sun.position.set(50, 100, 50);
        scene.add(sun);
        scene.add(new THREE.AmbientLight(0x404040, 0.5));

        // --- LÓGICA DE MOVIMIENTO ---
        let velocity = new THREE.Vector3();
        let direction = new THREE.Vector3();
        const moveKeys = { w: false, a: false, s: false, d: false, space: false };

        document.addEventListener('keydown', (e) => {
            if (e.code === 'KeyW') moveKeys.w = true;
            if (e.code === 'KeyA') moveKeys.a = true;
            if (e.code === 'KeyS') moveKeys.s = true;
            if (e.code === 'KeyD') moveKeys.d = true;
            if (e.code === 'Space') moveKeys.space = true;
        });

        document.addEventListener('keyup', (e) => {
            if (e.code === 'KeyW') moveKeys.w = false;
            if (e.code === 'KeyA') moveKeys.a = false;
            if (e.code === 'KeyS') moveKeys.s = false;
            if (e.code === 'KeyD') moveKeys.d = false;
            if (e.code === 'Space') moveKeys.space = false;
        });

        camera.position.y = 15; // Altura inicial

        function animate() {
            requestAnimationFrame(animate);

            if (controls.isLocked) {
                const delta = 0.15;
                velocity.x -= velocity.x * 10.0 * delta;
                velocity.z -= velocity.z * 10.0 * delta;
                velocity.y -= 9.8 * 0.1 * delta; // Gravedad simple

                direction.z = Number(moveKeys.w) - Number(moveKeys.s);
                direction.x = Number(moveKeys.d) - Number(moveKeys.a);
                direction.normalize();

                if (moveKeys.w || moveKeys.s) velocity.z -= direction.z * 400.0 * delta;
                if (moveKeys.a || moveKeys.d) velocity.x -= direction.x * 400.0 * delta;
                
                // Salto simple
                if (moveKeys.space && camera.position.y < 12) velocity.y += 5;

                controls.moveRight(-velocity.x * delta);
                controls.moveForward(-velocity.z * delta);
                camera.position.y += velocity.y * delta;

                // Suelo básico para no caer al infinito
                if (camera.position.y < 10) {
                    velocity.y = 0;
                    camera.position.y = 10;
                }
            }

            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
</html>
