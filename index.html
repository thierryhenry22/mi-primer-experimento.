<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Voxel Engine Elite - Realistic Life</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; }
        #crosshair { position: absolute; top: 50%; left: 50%; width: 10px; height: 10px; border: 1px solid white; transform: translate(-50%, -50%); }
    </style>
</head>
<body>
    <div id="crosshair"></div>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

        // --- MOTOR CORE ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true; // ACTIVAR SOMBRAS REALES
        document.body.appendChild(renderer.domElement);

        const controls = new PointerLockControls(camera, document.body);
        document.body.addEventListener('click', () => controls.lock());

        // --- SOL FÍSICO ---
        const sunGroup = new THREE.Group();
        const sunGeo = new THREE.SphereGeometry(2, 32, 32);
        const sunMat = new THREE.MeshBasicMaterial({ color: 0xffff00 });
        const sunMesh = new THREE.Mesh(sunGeo, sunMat);
        sunMesh.position.set(40, 60, -40);
        scene.add(sunMesh);

        const sunLight = new THREE.DirectionalLight(0xffffff, 1.5);
        sunLight.position.copy(sunMesh.position);
        sunLight.castShadow = true;
        scene.add(sunLight, new THREE.AmbientLight(0xffffff, 0.4));

        // --- MODELADO DE ANIMALES PROFESIONAL (OVEJA) ---
        function createSheep(x, y, z) {
            const sheep = new THREE.Group();
            const whiteMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
            const skinMat = new THREE.MeshStandardMaterial({ color: 0xffdbac });
            const blackMat = new THREE.MeshStandardMaterial({ color: 0x000000 });

            // Cuerpo
            const body = new THREE.Mesh(new THREE.BoxGeometry(0.8, 0.7, 1.2), whiteMat);
            body.position.y = 0.6;
            body.castShadow = true;
            sheep.add(body);

            // Cabeza
            const head = new THREE.Group();
            const face = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.5, 0.5), whiteMat);
            
            // Ojos
            const eyeGeo = new THREE.BoxGeometry(0.1, 0.1, 0.1);
            const eyeL = new THREE.Mesh(eyeGeo, blackMat);
            eyeL.position.set(0.15, 0.1, 0.26);
            const eyeR = new THREE.Mesh(eyeGeo, blackMat);
            eyeR.position.set(-0.15, 0.1, 0.26);
            
            head.add(face, eyeL, eyeR);
            head.position.set(0, 0.9, 0.7);
            sheep.add(head);

            // Patas
            const legGeo = new THREE.BoxGeometry(0.15, 0.4, 0.15);
            for(let i=0; i<4; i++) {
                const leg = new THREE.Mesh(legGeo, skinMat);
                leg.position.set(i<2 ? 0.25 : -0.25, 0.2, i%2===0 ? 0.4 : -0.4);
                sheep.add(leg);
            }

            sheep.position.set(x, y, z);
            sheep.userData = { targetX: x, targetZ: z, timer: 0 };
            scene.add(sheep);
            return sheep;
        }

        // --- FLORES CON DETALLE ---
        function createFlower(x, y, z) {
            const group = new THREE.Group();
            const stem = new THREE.Mesh(new THREE.BoxGeometry(0.05, 0.4, 0.05), new THREE.MeshStandardMaterial({color: 0x228B22}));
            const petals = new THREE.Mesh(new THREE.BoxGeometry(0.3, 0.1, 0.3), new THREE.MeshStandardMaterial({color: Math.random() > 0.5 ? 0xffffff : 0xff0000}));
            const center = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.11, 0.1), new THREE.MeshStandardMaterial({color: 0xffff00}));
            petals.position.y = 0.2;
            center.position.y = 0.21;
            group.add(stem, petals, center);
            group.position.set(x, y + 0.2, z);
            scene.add(group);
        }

        // --- TERRENO (BASE ORIGINAL PERO MEJORADA) ---
        const getH = (x, z) => Math.floor(Math.sin(x*0.1)*2 + Math.cos(z*0.1)*2 + 5);
        const animals = [];
        const geoBlock = new THREE.BoxGeometry(0.995, 0.995, 0.995);
        const matGrass = new THREE.MeshStandardMaterial({ color: 0x4d8c3a });

        for(let x=-25; x<25; x++) {
            for(let z=-25; z<25; z++) {
                const y = getH(x, z);
                const b = new THREE.Mesh(geoBlock, matGrass);
                b.position.set(x, y, z);
                b.receiveShadow = true;
                scene.add(b);
                if(Math.random() < 0.04) createFlower(x, y+0.5, z);
                if(Math.random() < 0.008) animals.push(createSheep(x, y+0.5, z));
            }
        }

        // --- CONTROLES Y FÍSICA ---
        let velY = 0;
        let canJump = false;
        const keys = {};
        window.onkeydown = (e) => keys[e.code] = true;
        window.onkeyup = (e) => keys[e.code] = false;

        camera.position.set(0, 15, 0);

        function animate() {
            requestAnimationFrame(animate);
            if(controls.isLocked) {
                const s = 0.25; // VELOCIDAD ALTA
                if(keys['KeyW']) controls.moveForward(s);
                if(keys['KeyS']) controls.moveForward(-s);
                if(keys['KeyA']) controls.moveRight(-s);
                if(keys['KeyD']) controls.moveRight(s);
                if(keys['Space'] && canJump) { velY = 0.24; canJump = false; }

                velY -= 0.01;
                camera.position.y += velY;
                const ground = getH(Math.round(camera.position.x), Math.round(camera.position.z)) + 1.8;
                if(camera.position.y < ground) {
                    camera.position.y = ground;
                    velY = 0;
                    canJump = true;
                }

                // AI ANIMAL
                animals.forEach(a => {
                    a.userData.timer--;
                    if(a.userData.timer <= 0) {
                        a.userData.targetX = a.position.x + (Math.random()-0.5)*5;
                        a.userData.targetZ = a.position.z + (Math.random()-0.5)*5;
                        a.userData.timer = 120;
                    }
                    a.position.x += (a.userData.targetX - a.position.x) * 0.01;
                    a.position.z += (a.userData.targetZ - a.position.z) * 0.01;
                    a.lookAt(a.userData.targetX, a.position.y, a.userData.targetZ);
                });
            }
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
