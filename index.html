<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>HENRY CRAFT: FINAL VERSION</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'VT323', monospace; }

        /* PANTALLA DE CARGA / MENÚ */
        #menu-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4); /* Sombra para resaltar texto */
            display: flex; flex-direction: column; justify-content: center;
            padding-left: 5%; z-index: 99; transition: opacity 0.5s;
        }

        h1 {
            font-size: 140px; color: #fff; margin: 0;
            text-shadow: 8px 8px 0 #000; letter-spacing: -5px; line-height: 0.8;
        }
        h1 span { color: #e74c3c; } /* Rojo Henry */
        
        .btn-group { margin-top: 50px; display: flex; flex-direction: column; gap: 15px; }
        
        button {
            width: 280px; padding: 15px; font-family: 'VT323', monospace; font-size: 40px;
            background: #7f8c8d; color: white; border: 4px solid #fff;
            text-shadow: 2px 2px 0 #000; cursor: pointer; text-align: left;
            transition: transform 0.1s, background 0.1s;
        }
        button:hover { background: #e74c3c; transform: scale(1.1) translateX(20px); }

        #ui-hud {
            position: absolute; bottom: 20px; left: 20px; 
            color: white; font-size: 24px; display: none;
            text-shadow: 2px 2px 0 #000;
        }
    </style>
</head>
<body>

    <div id="menu-screen">
        <h1>HENRY<br><span>CRAFT</span></h1>
        <div class="btn-group">
            <button id="btn-jugar">JUGAR</button>
            <button>OPCIONES</button>
        </div>
    </div>

    <div id="ui-hud">FPS: 60 | BLOQUES: INFINITOS</div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';

        // --- VARIABLES GLOBALES ---
        let isMenu = true;
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB);
        scene.fog = new THREE.Fog(0x87CEEB, 20, 80);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // --- ILUMINACIÓN ---
        const sun = new THREE.DirectionalLight(0xffffff, 1.2);
        sun.position.set(50, 100, 50);
        sun.castShadow = true;
        sun.shadow.mapSize.width = 2048; 
        sun.shadow.mapSize.height = 2048;
        scene.add(sun, new THREE.AmbientLight(0xffffff, 0.4));

        // --- MATERIALES ---
        const matGrass = new THREE.MeshStandardMaterial({ color: 0x5da130 }); // Verde vibrante
        const matLog = new THREE.MeshStandardMaterial({ color: 0x5d4037 });
        const matLeaves = new THREE.MeshStandardMaterial({ color: 0x388e3c });
        
        // MATERIALES HENRY
        const matRed = new THREE.MeshStandardMaterial({ color: 0xff0000 });
        const matBlue = new THREE.MeshStandardMaterial({ color: 0x0000ff });
        const matSkin = new THREE.MeshStandardMaterial({ color: 0xffdbac });

        // --- GENERACIÓN DE TERRENO ---
        const geoBlock = new THREE.BoxGeometry(1, 1, 1);
        function getH(x, z) {
            // Terreno ondulado interesante
            return Math.floor(Math.sin(x*0.1)*3 + Math.cos(z*0.1)*3 + 6);
        }

        // --- HENRY (El Protagonista) ---
        let henry;
        function createHenry() {
            const group = new THREE.Group();
            
            // Cabeza
            const head = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.5, 0.5), matSkin);
            head.position.y = 1.65;
            
            // Torso Rojo
            const body = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.7, 0.25), matRed);
            body.position.y = 1.05;

            // Piernas Azules
            const legL = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.75, 0.2), matBlue);
            legL.position.set(0.12, 0.35, 0);
            const legR = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.75, 0.2), matBlue);
            legR.position.set(-0.12, 0.35, 0);

            // Brazos
            const armL = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.7, 0.2), matRed);
            armL.position.set(0.36, 1.05, 0);
            const armR = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.7, 0.2), matRed);
            armR.position.set(-0.36, 1.05, 0);

            group.add(head, body, legL, legR, armL, armR);
            group.castShadow = true;
            return group;
        }

        // Posicionamos a Henry en el mundo para que se vea en el menú
        henry = createHenry();
        const startX = 5; const startZ = 5;
        const startY = getH(startX, startZ);
        henry.position.set(startX, startY, startZ);
        henry.rotation.y = -Math.PI / 4; // Mirando hacia la cámara del menú
        scene.add(henry);

        // --- ÁRBOLES Y DETALLES ---
        function createTree(x, y, z) {
            const tree = new THREE.Group();
            const log = new THREE.Mesh(new THREE.BoxGeometry(0.8, 4, 0.8), matLog);
            log.position.y = 2;
            log.castShadow = true;
            
            const leaves = new THREE.Mesh(new THREE.BoxGeometry(3, 2, 3), matLeaves);
            leaves.position.y = 4;
            leaves.castShadow = true;

            tree.add(log, leaves);
            tree.position.set(x, y, z);
            scene.add(tree);
        }

        // GENERAR MUNDO ALREDEDOR (Radio visible)
        for(let x=-20; x<20; x++) {
            for(let z=-20; z<20; z++) {
                const y = getH(x, z);
                const block = new THREE.Mesh(geoBlock, matGrass);
                block.position.set(x, y, z);
                block.receiveShadow = true;
                scene.add(block);

                if(Math.random() < 0.02 && (Math.abs(x - startX) > 2)) { // No poner árboles encima de Henry
                    createTree(x, y+1, z);
                }
            }
        }

        // --- LÓGICA DEL JUEGO ---
        const controls = new PointerLockControls(camera, document.body);
        const btnJugar = document.getElementById('btn-jugar');
        const menuScreen = document.getElementById('menu-screen');
        const hud = document.getElementById('ui-hud');

        btnJugar.addEventListener('click', () => {
            isMenu = false;
            menuScreen.style.opacity = '0';
            setTimeout(() => { menuScreen.style.display = 'none'; hud.style.display = 'block'; }, 500);
            
            // Transición: La cámara entra en Henry
            henry.visible = false; // Desaparece Henry porque ahora ERES tú
            camera.position.set(startX, startY + 2, startZ);
            controls.lock();
        });

        // Física básica
        let velocity = new THREE.Vector3();
        let move = { f:false, b:false, l:false, r:false };
        window.onkeydown = (e) => {
            if(e.code == 'KeyW') move.f = true;
            if(e.code == 'KeyS') move.b = true;
            if(e.code == 'KeyA') move.l = true;
            if(e.code == 'KeyD') move.r = true;
            if(e.code == 'Space') velocity.y = 0.2;
        };
        window.onkeyup = (e) => {
            if(e.code == 'KeyW') move.f = false;
            if(e.code == 'KeyS') move.b = false;
            if(e.code == 'KeyA') move.l = false;
            if(e.code == 'KeyD') move.r = false;
        };

        let time = 0;
        function animate() {
            requestAnimationFrame(animate);
            time += 0.01;

            if(isMenu) {
                // *** CÁMARA DE MENÚ ***
                // La cámara orbita alrededor de Henry para que lo veas a él y al mundo
                camera.position.x = henry.position.x + Math.sin(time * 0.5) * 6;
                camera.position.z = henry.position.z + Math.cos(time * 0.5) * 6;
                camera.position.y = henry.position.y + 3;
                camera.lookAt(henry.position.x, henry.position.y + 1, henry.position.z);
            } else {
                // *** JUEGO REAL ***
                if(controls.isLocked) {
                    const speed = 0.15;
                    if(move.f) controls.moveForward(speed);
                    if(move.b) controls.moveForward(-speed);
                    if(move.l) controls.moveRight(-speed);
                    if(move.r) controls.moveRight(speed);
                    
                    velocity.y -= 0.01;
                    camera.position.y += velocity.y;
                    
                    const ground = getH(Math.round(camera.position.x), Math.round(camera.position.z)) + 1.8;
                    if(camera.position.y < ground) {
                        camera.position.y = ground;
                        velocity.y = 0;
                    }
                }
            }
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
