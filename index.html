#include <stdio.h>
#include <string.h>

#define MAX_ESTUDIANTES 50

// Estructura solicitada en el proyecto
struct Estudiante {
    int matricula;
    char nombre[50];
    float notas[3]; // [0]: Parcial 1, [1]: Parcial 2, [2]: Proyecto
    float promedio;
};

// Prototipos de funciones
void registrarEstudiantes(struct Estudiante grupo[], int *total);
void calcularPromedios(struct Estudiante grupo[], int total);
void mostrarReporte(struct Estudiante grupo[], int total);
void buscarEstudiante(struct Estudiante grupo[], int total);

int main() {
    struct Estudiante seccion[MAX_ESTUDIANTES];
    int numEstudiantes = 0;
    int opcion;

    do {
        printf("\n--- SISTEMA DE GESTION UPTA ---");
        printf("\n1. Registrar Estudiantes");
        printf("\n2. Calcular Promedios");
        printf("\n3. Ver Reporte General");
        printf("\n4. Buscar Estudiante");
        printf("\n5. Salir");
        printf("\nSeleccione una opcion: ");
        scanf("%d", &opcion);

        switch(opcion) {
            case 1:
                registrarEstudiantes(seccion, &numEstudiantes);
                break;
            case 2:
                calcularPromedios(seccion, numEstudiantes);
                break;
            case 3:
                mostrarReporte(seccion, numEstudiantes);
                break;
            case 4:
                buscarEstudiante(seccion, numEstudiantes);
                break;
            case 5:
                printf("Saliendo del sistema...\n");
                break;
            default:
                printf("Opcion no valida.\n");
        }
    } while(opcion != 5);

    return 0;
}

void registrarEstudiantes(struct Estudiante grupo[], int *total) {
    int cantidad, i, j;
    printf("¿Cuantos estudiantes desea registrar? ");
    scanf("%d", &cantidad);

    for(i = 0; i < cantidad; i++) {
        printf("\n--- Datos del Estudiante %d ---\n", *total + 1);
        printf("Matricula: ");
        scanf("%d", &grupo[*total].matricula);
        getchar(); // Limpiar el buffer
        printf("Nombre completo: ");
        fgets(grupo[*total].nombre, 50, stdin);
        grupo[*total].nombre[strcspn(grupo[*total].nombre, "\n")] = 0; // Quitar el salto de linea

        for(j = 0; j < 3; j++) {
            do {
                printf("Nota %d (0-20): ", j + 1);
                scanf("%f", &grupo[*total].notas[j]);
                if(grupo[*total].notas[j] < 0 || grupo[*total].notas[j] > 20) {
                    printf("¡Error! La nota debe estar entre 0 y 20.\n");
                }
            } while(grupo[*total].notas[j] < 0 || grupo[*total].notas[j] > 20);
        }
        (*total)++;
    }
}

void calcularPromedios(struct Estudiante grupo[], int total) {
    if(total == 0) {
        printf("No hay datos registrados.\n");
        return;
    }
    for(int i = 0; i < total; i++) {
        float suma = 0;
        for(int j = 0; j < 3; j++) {
            suma += grupo[i].notas[j];
        }
        grupo[i].promedio = suma / 3;
    }
    printf("Promedios calculados exitosamente.\n");
}

void mostrarReporte(struct Estudiante grupo[], int total) {
    if(total == 0) {
        printf("No hay datos para mostrar.\n");
        return;
    }
    printf("\n%-10s %-20s %-10s %-10s %-10s %-10s %-10s\n", 
           "Matricula", "Nombre", "P1", "P2", "Proj", "Prom", "Estado");
    printf("--------------------------------------------------------------------------------\n");
    for(int i = 0; i < total; i++) {
        printf("%-10d %-20s %-10.2f %-10.2f %-10.2f %-10.2f %-10s\n",
               grupo[i].matricula, 
               grupo[i].nombre, 
               grupo[i].notas[0], 
               grupo[i].notas[1], 
               grupo[i].notas[2], 
               grupo[i].promedio,
               (grupo[i].promedio >= 9.5) ? "APROBADO" : "REPROBADO");
    }
}

void buscarEstudiante(struct Estudiante grupo[], int total) {
    int buscaMat;
    int encontrado = 0;
    printf("Ingrese la matricula a buscar: ");
    scanf("%d", &buscaMat);

    for(int i = 0; i < total; i++) {
        if(grupo[i].matricula == buscaMat) {
            printf("\nEstudiante encontrado: %s", grupo[i].nombre);
            printf("\nPromedio: %.2f\n", grupo[i].promedio);
            encontrado = 1;
            break;
        }
    }
    if(!encontrado) printf("Estudiante no registrado.\n");
}
